<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ –ò—Å—Ç–æ—Ä–∏–π —Å –û–∑–≤—É—á–∫–æ–π</title>
    <style>
        /*
        * CSS - –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–£–¥–∞–ª–µ–Ω #initial-overlay)
        */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            min-height: 100vh;
            box-sizing: border-box;
        }

        h1 {
            color: #4CAF50;
        }

        #controls {
            margin-bottom: 30px;
            display: flex; /* –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã */
            gap: 15px;
        }

        button.story-button {
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        #start-scary { background-color: #f44336; color: white; }
        #start-scary:hover { background-color: #d32f2f; }

        #start-strange { background-color: #ff9800; color: white; }
        #start-strange:hover { background-color: #f57c00; }

        #start-funny { background-color: #2196f3; color: white; }
        #start-funny:hover { background-color: #1976d2; }

        #story-container {
            background-color: #1e1e1e;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 800px;
            min-height: 200px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        #story-text {
            font-size: 1.2em;
            line-height: 1.6;
            margin: 0;
            white-space: pre-wrap;
        }

        #voice-settings {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            width: 90%;
            max-width: 800px;
            text-align: left;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        input[type="range"] {
            width: 70%;
        }
    </style>
</head>
<body>

    <h1>üéÆ –ò–≥—Ä–∞ –ò—Å—Ç–æ—Ä–∏–π</h1>

    <div id="controls">
        <button id="start-scary" class="story-button">–°—Ç—Ä–∞—à–Ω–∞—è üëª</button>
        <button id="start-strange" class="story-button">–°—Ç—Ä–∞–Ω–Ω–∞—è üëΩ</button>
        <button id="start-funny" class="story-button">–°–º–µ—à–Ω–∞—è üòÇ</button>
    </div>

    <div id="voice-settings">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–æ–ª–æ—Å–∞ (–¢–æ–Ω–∞)</h3>
        <p>–≠—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –æ–∑–≤—É—á–∫—É —Ç–µ–∫—Å—Ç–∞.</p>

        <div class="setting-row">
            <label for="pitch-range">–¢–æ–Ω –≥–æ–ª–æ—Å–∞ (–í—ã—Å–æ—Ç–∞):</label>
            <input type="range" id="pitch-range" min="0" max="2" step="0.1" value="1">
            <span id="pitch-value">1.0</span>
        </div>

        <div class="setting-row">
            <label for="rate-range">–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏:</label>
            <input type="range" id="rate-range" min="0.5" max="2" step="0.1" value="1">
            <span id="rate-value">1.0</span>
        </div>
    </div>

    <div id="story-container">
        <p id="story-text">–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.</p>
    </div>

    <button id="next-part" style="display: none; margin-top: 20px;" disabled>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ></button>

    <script>
        /*
        * JAVASCRIPT - –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã, –æ–∑–≤—É—á–∫–∞ –∏ –∑–≤—É–∫
        */

        // === 1. –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ===
        // –£–±—Ä–∞–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ overlay
        const storyTextElement = document.getElementById('story-text');
        const nextButton = document.getElementById('next-part');
        const pitchRange = document.getElementById('pitch-range');
        const rateRange = document.getElementById('rate-range');
        const pitchValueSpan = document.getElementById('pitch-value');
        const rateValueSpan = document.getElementById('rate-value');

        // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        let currentStory = [];
        let currentPartIndex = 0;
        let isSpeaking = false;
        let ttsEnabled = ('speechSynthesis' in window); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

        // === 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –¥–∞–Ω–Ω—ã–µ ===

        const soundEffects = {}; // –û–±—ä–µ–∫—Ç –¥–ª—è –∑–≤—É–∫–æ–≤ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—É—Å—Ç—ã–º, –ø–æ–∫–∞ —Ç—ã –∏—Ö –Ω–µ –¥–æ–±–∞–≤–∏—à—å

        // üí° –í–ù–ò–ú–ê–ù–ò–ï: –ï—Å–ª–∏ —Ç—ã –¥–æ–±–∞–≤–∏—à—å —Å–≤–æ–∏ –∑–≤—É–∫–∏, –†–ê–°–ö–û–ú–ú–ï–ù–¢–ò–†–£–ô –≠–¢–û–¢ –ë–õ–û–ö:
        /*
        const soundEffects = {
            knocks: new Audio('sounds/knocks.mp3'),
            scream: new Audio('sounds/scream.mp3'),
            laugh: new Audio('sounds/laugh.mp3')
        };
        soundEffects.knocks.volume = 0.7;
        soundEffects.scream.volume = 0.8;
        soundEffects.laugh.volume = 0.6;
        */

        // –ë–∞–∑—ã –∏—Å—Ç–æ—Ä–∏–π (–û—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏)
        const allStories = {
            scary: [
                // –°—Ç—Ä–∞—à–Ω–∞—è –ò—Å—Ç–æ—Ä–∏—è 1
                [
                    "–ù–æ—á—å –±—ã–ª–∞ —Ç–µ–º–Ω–æ–π –∏ —Ç–∏—Ö–æ–π. –Ø —á–∏—Ç–∞–ª –∫–Ω–∏–≥—É, –∏ –º–Ω–µ –∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —è –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ –æ–¥–∏–Ω. [KNOCKS]",
                    "–í–¥—Ä—É–≥ –ø–æ –¥–≤–µ—Ä–∏ –∫—Ç–æ-—Ç–æ –Ω–∞—á–∞–ª —Å—Ç—É—á–∞—Ç—å. –ì—Ä–æ–º–∫–∏–µ –∏ –º–µ–¥–ª–µ–Ω–Ω—ã–µ **—Å—Ç—É–∫–∏** —Ä–∞–∑–¥–∞–≤–∞–ª–∏—Å—å –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º. –Ø –∑–∞–º–µ—Ä.",
                    "–Ø –ø–æ–¥–æ—à–µ–ª –∫ –¥–≤–µ—Ä–∏ –∏ —Å–ø—Ä–æ—Å–∏–ª: '–ö—Ç–æ —Ç–∞–º?' –í –æ—Ç–≤–µ—Ç –±—ã–ª–∞ —Ç–∏—à–∏–Ω–∞... –∞ –ø–æ—Ç–æ–º —Ä–∞–∑–¥–∞–ª—Å—è –ª–µ–¥–µ–Ω—è—â–∏–π –¥—É—à—É –∫—Ä–∏–∫. [SCREAM]",
                    "–ö–æ–Ω–µ—Ü. –í—ã–∂–∏–ª –ª–∏ —è? –≠—Ç–æ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∑–∞–≥–∞–¥–∫–æ–π..."
                ],
                // –°—Ç—Ä–∞—à–Ω–∞—è –ò—Å—Ç–æ—Ä–∏—è 2 (–ù–û–í–ê–Ø)
                [
                    "–Ø –µ—Ö–∞–ª –ø–æ –ø—É—Å—Ç–æ–π —Ç—Ä–∞—Å—Å–µ, –∏ –≤–¥—Ä—É–≥ —Ñ–∞—Ä—ã –æ—Å–≤–µ—Ç–∏–ª–∏ —Å—Ç–∞—Ä—É—é, –∑–∞–±—Ä–æ—à–µ–Ω–Ω—É—é –±–µ–Ω–∑–æ–∫–æ–ª–æ–Ω–∫—É. [SCREAM]",
                    "–î–≤–∏–≥–∞—Ç–µ–ª—å –∑–∞–≥–ª–æ—Ö. –Ø –≤—ã—à–µ–ª –∏ —É—Å–ª—ã—à–∞–ª, –∫–∞–∫ —á—Ç–æ-—Ç–æ —Å–∫—Ä–µ–±–µ—Ç—Å—è –ø–æ –º–µ—Ç–∞–ª–ª—É. [KNOCKS]",
                    "–ù–∞–¥–ø–∏—Å—å –Ω–∞ —Å—Ç–µ–Ω–µ –≥–ª–∞—Å–∏–ª–∞: '–£—Ö–æ–¥–∏, –ø–æ–∫–∞ –º–æ–∂–µ—à—å'. –Ø –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª, –∫–∞–∫ –∫—Ç–æ-—Ç–æ –¥—ã—à–∏—Ç –º–Ω–µ –≤ —à–µ—é.",
                    "–ö–æ–Ω–µ—Ü. –ü–æ—Ö–æ–∂–µ, —Å–µ–≥–æ–¥–Ω—è —è –æ—Å—Ç–∞–Ω—É—Å—å –∑–¥–µ—Å—å –Ω–∞–≤—Å–µ–≥–¥–∞..."
                ]
            ],
            strange: [
                // –°—Ç—Ä–∞–Ω–Ω–∞—è –ò—Å—Ç–æ—Ä–∏—è 1
                [
                    "–Ø —à–µ–ª –ø–æ —É–ª–∏—Ü–µ –∏ —É–≤–∏–¥–µ–ª –∫–æ—Ç–∞. –û–±—ã—á–Ω—ã–π —Å–µ—Ä—ã–π –∫–æ—Ç. –ù–æ –æ–Ω —Å–∏–¥–µ–ª –Ω–∞ –¥–µ—Ä–µ–≤–µ –∏ —á–∏—Ç–∞–ª –≥–∞–∑–µ—Ç—É.",
                    "–Ø –ø—Ä–æ—Ç–µ—Ä –≥–ª–∞–∑–∞. –ö–æ—Ç —Å–ª–æ–∂–∏–ª –≥–∞–∑–µ—Ç—É, –ø–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞ –º–µ–Ω—è –∏ —Å–∫–∞–∑–∞–ª: '–£–∂–µ –Ω–µ —Ç–∞–∫ —Ç–∏—Ö–æ, –∫–∞–∫ —Ä–∞–Ω—å—à–µ'.",
                    "–û–Ω —Å–ø—Ä—ã–≥–Ω—É–ª –∏ –ø–æ–±–µ–∂–∞–ª –≤ —Å—Ç–æ—Ä–æ–Ω—É –±–ª–∏–∂–∞–π—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞. –Ø –¥–æ–≥–Ω–∞–ª –µ–≥–æ –∏ —Å–ø—Ä–æ—Å–∏–ª, —á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç. –û–Ω —Ç–æ–ª—å–∫–æ —Ä–∞—Å—Å–º–µ—è–ª—Å—è. [LAUGH]",
                    "–ö–æ–Ω–µ—Ü. –Ø –¥–æ —Å–∏—Ö –ø–æ—Ä –Ω–µ –∑–Ω–∞—é, —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ –∑–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ –≥–∞–∑–µ—Ç–µ..."
                ],
                // –°—Ç—Ä–∞–Ω–Ω–∞—è –ò—Å—Ç–æ—Ä–∏—è 2 (–ù–û–í–ê–Ø)
                [
                    "–í—á–µ—Ä–∞ –≤–µ—á–µ—Ä–æ–º –º–Ω–µ –ø—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –º–æ–µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞: '–¢—ã –∑–∞–±—ã–ª, –∫–∞–∫ –ª–µ—Ç–∞—Ç—å'.",
                    "–Ø –ø–æ–ø—ã—Ç–∞–ª—Å—è –æ—Ç–≤–µ—Ç–∏—Ç—å, –Ω–æ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–∫–∞–∑–∞–ª –æ—à–∏–±–∫—É. –ó–∞—Ç–µ–º —è –ø–æ—Å–º–æ—Ç—Ä–µ–ª –≤ –æ–∫–Ω–æ –∏ —É–≤–∏–¥–µ–ª... —Å–∏–Ω–∏–π —Å–≤–µ—Ç.",
                    "–Ø –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª –ª–µ–≥–∫–æ–µ –ø–æ–∫–∞–ª—ã–≤–∞–Ω–∏–µ –∏ –ø–æ–Ω—è–ª, —á—Ç–æ –Ω–∞—Ö–æ–∂—É—Å—å –Ω–∞ –ø–æ—Ç–æ–ª–∫–µ. –Ø –ø—Ä–æ—Å—Ç–æ —Ç–∞–º –≤–∏—Å–µ–ª –∏ —Å–º–µ—è–ª—Å—è. [LAUGH]",
                    "–ö–æ–Ω–µ—Ü. –°–µ–≥–æ–¥–Ω—è —è –∑–∞–≤—Ç—Ä–∞–∫–∞–ª, –≤–∏—Å—è –≤–Ω–∏–∑ –≥–æ–ª–æ–≤–æ–π. –ñ–∏–∑–Ω—å –Ω–∞–ª–∞–∂–∏–≤–∞–µ—Ç—Å—è!"
                ]
            ],
            funny: [
                // –°–º–µ—à–Ω–∞—è –ò—Å—Ç–æ—Ä–∏—è 1
                [
                    "–Ø —Ä–µ—à–∏–ª –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–æ—Ä—Ç –ø–æ –Ω–æ–≤–æ–º—É —Ä–µ—Ü–µ–ø—Ç—É. –í—Å–µ —à–ª–æ —Ö–æ—Ä–æ—à–æ, –ø–æ–∫–∞ —è –Ω–µ –ø–æ–Ω—è–ª, —á—Ç–æ –ø–µ—Ä–µ–ø—É—Ç–∞–ª —Å–∞—Ö–∞—Ä —Å —Å–æ–ª—å—é.",
                    "–¢–µ—Å—Ç–æ –≤—ã–≥–ª—è–¥–µ–ª–æ —Å—Ç—Ä–∞–Ω–Ω–æ, –Ω–æ —è —Ä–µ—à–∏–ª: '–ù—É, —ç—Ç–æ –±—É–¥–µ—Ç '–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π' —Ç–æ—Ä—Ç!' –Ø –ø–æ—Å—Ç–∞–≤–∏–ª –µ–≥–æ –≤ –¥—É—Ö–æ–≤–∫—É.",
                    "–ß–µ—Ä–µ–∑ —á–∞—Å —è –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª. –≠—Ç–æ –±—ã–ª–æ —É–∂–∞—Å–Ω–æ. –ù–æ –º–æ–π –¥—Ä—É–≥ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª –∏... –Ω–∞—á–∞–ª –≥—Ä–æ–º–∫–æ —Å–º–µ—è—Ç—å—Å—è! [LAUGH]",
                    "–ö–æ–Ω–µ—Ü. –û–Ω —Å–∫–∞–∑–∞–ª, —á—Ç–æ —ç—Ç–æ —Å–∞–º—ã–π —Å–º–µ—à–Ω–æ–π —Ç–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω –∫–æ–≥–¥–∞-–ª–∏–±–æ –≤–∏–¥–µ–ª. –ü—è—Ç—å –∏–∑ –ø—è—Ç–∏ –ø–æ —à–∫–∞–ª–µ '—Å—Ç—Ä–∞–Ω–Ω–æ—Å—Ç–∏'!"
                ],
                // –°–º–µ—à–Ω–∞—è –ò—Å—Ç–æ—Ä–∏—è 2 (–ù–û–í–ê–Ø)
                [
                    "–ú–æ–π –±—É–¥–∏–ª—å–Ω–∏–∫ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∑–≤–æ–Ω–∏–ª –≤ 3 —É—Ç—Ä–∞. –Ø –≤—Å—Ç–∞–ª, –æ–¥–µ–ª—Å—è, –ø–æ—à–µ–ª –Ω–∞ –∫—É—Ö–Ω—é –∏ –Ω–∞—á–∞–ª –≤–∞—Ä–∏—Ç—å –∫–æ—Ñ–µ.",
                    "–ü–æ—Ç–æ–º —è –ø–æ–Ω—è–ª, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è —Å—É–±–±–æ—Ç–∞, –∏ —è –Ω–µ –¥–æ–ª–∂–µ–Ω –Ω–∏–∫—É–¥–∞ –∏–¥—Ç–∏. –Ø –ø—Ä–æ—Å—Ç–æ —Å–µ–ª –∏ –≥—Ä–æ–º–∫–æ –∑–∞—Å–º–µ—è–ª—Å—è. [LAUGH]",
                    "–Ø —Ä–µ—à–∏–ª –ª–µ—á—å —Å–ø–∞—Ç—å, –Ω–æ –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏ –ø–æ–¥—É—à–∫—É. –û–Ω–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–∞ –∫–æ—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–µ–ª –æ—á–µ–Ω—å –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–º. [SCREAM]",
                    "–ö–æ–Ω–µ—Ü. –ö–æ—Ç –æ–±–∏–¥–µ–ª—Å—è –∏ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª –¥–≤–æ–π–Ω—É—é –ø–æ—Ä—Ü–∏—é –∑–∞–≤—Ç—Ä–∞–∫–∞ –∑–∞ —Ç–æ, —á—Ç–æ —è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –µ–≥–æ –∫–∞–∫ –º–µ–±–µ–ª—å."
                ]
            ]
        };

        // === 3. –õ–æ–≥–∏–∫–∞ –æ–∑–≤—É—á–∫–∏ (Text-to-Speech) ===

        function speakText(text) {
            // –ï—Å–ª–∏ ttsEnabled = false, –º—ã –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ–∑–≤—É—á–∫—É, –Ω–µ –≤—ã–≤–æ–¥—è –æ—à–∏–±–æ–∫
            if (!ttsEnabled) return;

            const utterance = new SpeechSynthesisUtterance(text);

            utterance.rate = parseFloat(rateRange.value);
            utterance.pitch = parseFloat(pitchRange.value);

            // –†–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –æ–∑–≤—É—á–∫–∏
            utterance.onend = () => {
                isSpeaking = false;
                nextButton.disabled = false;
                nextButton.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å >';
            };

            // –ï—Å–ª–∏ –æ–∑–≤—É—á–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞, —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            utterance.onerror = (event) => {
                 console.error('–û—à–∏–±–∫–∞ –æ–∑–≤—É—á–∫–∏:', event.error);
                 isSpeaking = false;
                 nextButton.disabled = false;
                 nextButton.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å (–æ—à–∏–±–∫–∞) >';
            };

            isSpeaking = true;
            speechSynthesis.speak(utterance);
        }

        function checkAndPlaySound(partText) {
            for (let key in soundEffects) {
                if (soundEffects[key] && soundEffects[key].pause) {
                    soundEffects[key].pause();
                    soundEffects[key].currentTime = 0;
                }
            }

            if (partText.includes('[KNOCKS]') && soundEffects.knocks) {
                soundEffects.knocks.play();
            } else if (partText.includes('[SCREAM]') && soundEffects.scream) {
                soundEffects.scream.play();
            } else if (partText.includes('[LAUGH]') && soundEffects.laugh) {
                soundEffects.laugh.play();
            }

            return partText.replace(/\[(KNOCKS|SCREAM|LAUGH)\]/g, '').trim();
        }


        // === 4. –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —á–∞—Å—Ç—è–º–∏ ===

        function showNextPart() {
            // –ï—Å–ª–∏ –∏–¥–µ—Ç –æ–∑–≤—É—á–∫–∞, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ—ë, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏
            if (isSpeaking && ttsEnabled) {
                speechSynthesis.cancel();
                isSpeaking = false;
            }

            // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å
            if (currentPartIndex >= currentStory.length) {
                storyTextElement.textContent = "–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–æ–Ω—á–µ–Ω–∞! –í—ã–±–µ—Ä–∏ –Ω–æ–≤—ã–π –∂–∞–Ω—Ä.";
                nextButton.style.display = 'none';
                return;
            }

            const rawPart = currentStory[currentPartIndex];
            const cleanedText = checkAndPlaySound(rawPart);

            storyTextElement.textContent = cleanedText;

            if (ttsEnabled) {
                speakText(cleanedText);
                nextButton.disabled = true;
                nextButton.textContent = '–û–∑–≤—É—á–∫–∞...';
            } else {
                 // –ï—Å–ª–∏ –æ–∑–≤—É—á–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ (–∏–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è), –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º
                 nextButton.disabled = false;
                 nextButton.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å >';
            }

            currentPartIndex++;
        }

        /**
         * @description –ó–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤—É—é –∏—Å—Ç–æ—Ä–∏—é –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∂–∞–Ω—Ä—É, –≤—ã–±–∏—Ä–∞—è –µ–µ –°–õ–£–ß–ê–ô–ù–û.
         * @param {string} genre - –ñ–∞–Ω—Ä (scary, strange, funny).
         */
        function startStory(genre) {
            if (ttsEnabled) {
                speechSynthesis.cancel();
                isSpeaking = false;
            }

            // –°–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏
            const availableStories = allStories[genre];
            const randomIndex = Math.floor(Math.random() * availableStories.length);
            currentStory = availableStories[randomIndex];

            currentPartIndex = 0;

            nextButton.style.display = 'block';
            nextButton.disabled = false;
            nextButton.textContent = '–ù–∞—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é >';

            storyTextElement.textContent = `–í—ã –≤—ã–±—Ä–∞–ª–∏: ${genre === 'scary' ? '–°—Ç—Ä–∞—à–Ω–∞—è' : genre === 'strange' ? '–°—Ç—Ä–∞–Ω–Ω–∞—è' : '–°–º–µ—à–Ω–∞—è'}. –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é >"`;
        }

        // === 5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π ===
        // –£–±—Ä–∞–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è overlay. –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ –∂–∞–Ω—Ä–∞ - —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫.

        // –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∂–∞–Ω—Ä–∞
        document.getElementById('start-scary').addEventListener('click', () => startStory('scary'));
        document.getElementById('start-strange').addEventListener('click', () => startStory('strange'));
        document.getElementById('start-funny').addEventListener('click', () => startStory('funny'));

        // –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
        nextButton.addEventListener('click', showNextPart);

        // –ü–æ–ª–∑—É–Ω–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞
        pitchRange.addEventListener('input', () => {
            pitchValueSpan.textContent = pitchRange.value;
        });

        rateRange.addEventListener('input', () => {
            rateValueSpan.textContent = rateRange.value;
        });
    </script>
</body>
</html>
